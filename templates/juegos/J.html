{% extends "base.html" %}

{% block title %}Letra J - Alimentar la Jirafa{% endblock %}

{% block content %}
<div class="game-header">
    <h1 class="game-title">ü¶í Letra J - Alimentar la Jirafa</h1>
    <p class="game-description">¬°Arrastra la comida para alimentar a la jirafa!</p>
    <a href="{{ url_for('index') }}" class="back-button">üè† Volver al Men√∫</a>
</div>

<div class="game-canvas-container">
    <canvas id="gameCanvas" width="800" height="600"></canvas>
</div>
{% endblock %}

{% block extra_js %}
<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');

// Ajustar canvas a dispositivo m√≥vil
function resizeCanvas() {
    const container = canvas.parentElement;
    const maxWidth = Math.min(800, container.clientWidth - 40);
    const scale = maxWidth / 800;
    canvas.style.width = maxWidth + 'px';
    canvas.style.height = (600 * scale) + 'px';
}
resizeCanvas();
window.addEventListener('resize', resizeCanvas);

// Variables del juego
const giraffeX = 650; // Jirafa a la derecha
const giraffeY = 480; // En el suelo
let giraffeSize = 1;
let foodEaten = { jamon: false, jojoto: false, jugo: false };
let draggingFood = null;
let celebrating = false;
let foodPositions = {
    jamon: { x: 100, y: 400 },   // Izquierda
    jojoto: { x: 250, y: 400 },  // Izquierda-centro
    jugo: { x: 400, y: 400 }     // Centro
};

// Cargar im√°genes
const giraffeImg = new Image();
const jamonImg = new Image();
const jugoImg = new Image();
const jojotoImg = new Image();

giraffeImg.src = '/assets/img/jirafa.png';
jamonImg.src = '/assets/img/jamon.png';
jugoImg.src = '/assets/img/jugo.png';
jojotoImg.src = '/assets/img/jojoto.png';

// Dibujar jirafa
function drawGiraffe() {
    if (!giraffeImg.complete) return;
    
    ctx.save();
    ctx.translate(giraffeX, giraffeY);
    ctx.scale(giraffeSize, giraffeSize);
    
    // Dibujar la imagen de la jirafa centrada y en el suelo
    const imgWidth = 220;
    const imgHeight = 320;
    ctx.drawImage(giraffeImg, -imgWidth/2, -imgHeight + 50, imgWidth, imgHeight);
    
    ctx.restore();
}
// Dibujar comida (sin fondos, solo las im√°genes)
function drawFood() {
    // Jam√≥n
    if (!foodEaten.jamon && jamonImg.complete) {
        const jx = foodPositions.jamon.x;
        const jy = foodPositions.jamon.y;
        ctx.drawImage(jamonImg, jx - 50, jy - 50, 100, 100);
        ctx.font = 'bold 18px Arial';
        ctx.fillStyle = '#000';
        ctx.strokeStyle = 'white';
        ctx.lineWidth = 4;
        ctx.textAlign = 'center';
        ctx.strokeText('JAM√ìN', jx, jy + 70);
        ctx.fillText('JAM√ìN', jx, jy + 70);
    }
    
    // Jojoto (mazorca)
    if (!foodEaten.jojoto && jojotoImg.complete) {
        const mx = foodPositions.jojoto.x;
        const my = foodPositions.jojoto.y;
        ctx.drawImage(jojotoImg, mx - 50, my - 50, 100, 100);
        ctx.font = 'bold 18px Arial';
        ctx.fillStyle = '#000';
        ctx.strokeStyle = 'white';
        ctx.lineWidth = 4;
        ctx.textAlign = 'center';
        ctx.strokeText('JOJOTO', mx, my + 70);
        ctx.fillText('JOJOTO', mx, my + 70);
    }
    
    // Jugo
    if (!foodEaten.jugo && jugoImg.complete) {
        const jux = foodPositions.jugo.x;
        const juy = foodPositions.jugo.y;
        ctx.drawImage(jugoImg, jux - 50, juy - 50, 100, 100);
        ctx.font = 'bold 18px Arial';
        ctx.fillStyle = '#000';
        ctx.strokeStyle = 'white';
        ctx.lineWidth = 4;
        ctx.textAlign = 'center';
        ctx.strokeText('JUGO', jux, juy + 70);
        ctx.fillText('JUGO', jux, juy + 70);
    }
}

// Manejo de eventos
function handleStart(e) {
    e.preventDefault();
    if (celebrating) return;
    const pos = getInputPosition(e, canvas);
    
    // Verificar si toca alguna comida
    for (let food in foodPositions) {
        if (!foodEaten[food]) {
            const fx = foodPositions[food].x;
            const fy = foodPositions[food].y;
            if (Math.abs(pos.x - fx) < 50 && Math.abs(pos.y - fy) < 50) {
                draggingFood = food;
                break;
            }
        }
    }
}

function handleMove(e) {
    e.preventDefault();
    if (celebrating) return;
    const pos = getInputPosition(e, canvas);
    
    if (draggingFood) {
        foodPositions[draggingFood].x = pos.x;
        foodPositions[draggingFood].y = pos.y;
        
        // Verificar si est√° alimentando la jirafa
        if (Math.abs(pos.x - giraffeX) < 80 && Math.abs(pos.y - (giraffeY - 80)) < 60) {
            foodEaten[draggingFood] = true;
            draggingFood = null;
            giraffeSize += 0.15; // Crece m√°s notoriamente
            
            // Verificar si comi√≥ todo
            if (foodEaten.jamon && foodEaten.jojoto && foodEaten.jugo) {
                celebrating = true;
                setTimeout(() => {
                    showCelebration();
                }, 500);
            }
        }
    }
}

function handleEnd(e) {
    e.preventDefault();
    draggingFood = null;
}

canvas.addEventListener('mousedown', handleStart);
canvas.addEventListener('mousemove', handleMove);
canvas.addEventListener('mouseup', handleEnd);
canvas.addEventListener('touchstart', handleStart);
canvas.addEventListener('touchmove', handleMove);
canvas.addEventListener('touchend', handleEnd);

// Mostrar celebraci√≥n
function showCelebration() {
    console.log('üéâ ¬°La jirafa est√° alimentada!');
}

// Reiniciar juego
function resetGame() {
    giraffeSize = 1;
    foodEaten = { jamon: false, jojoto: false, jugo: false };
    draggingFood = null;
    celebrating = false;
    foodPositions = {
        jamon: { x: 100, y: 400 },
        jojoto: { x: 250, y: 400 },
        jugo: { x: 400, y: 400 }
    };
}

// Loop del juego
function gameLoop() {
    // Fondo
    const gradient = ctx.createLinearGradient(0, 0, 0, canvas.height);
    gradient.addColorStop(0, '#87CEEB');
    gradient.addColorStop(1, '#E0F6FF');
    ctx.fillStyle = gradient;
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    
    // Suelo
    ctx.fillStyle = '#90EE90';
    ctx.fillRect(0, 550, canvas.width, 50);
    
    // Dibujar jirafa y comida
    drawGiraffe();
    drawFood();
    
    // Instrucciones
    if (!celebrating) {
        ctx.font = 'bold 24px Arial';
        ctx.fillStyle = '#1565C0';
        ctx.strokeStyle = 'white';
        ctx.lineWidth = 5;
        ctx.textAlign = 'center';
        ctx.strokeText('üçñ ¬°Arrastra la comida a la jirafa!', canvas.width / 2, 40);
        ctx.fillText('üçñ ¬°Arrastra la comida a la jirafa!', canvas.width / 2, 40);
    }
    
    // Celebraci√≥n
    if (celebrating) {
        // Fondo semi-transparente
        ctx.fillStyle = 'rgba(0, 0, 0, 0.5)';
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        
        ctx.font = 'bold 80px Arial';
        ctx.fillStyle = '#FFD700';
        ctx.strokeStyle = 'white';
        ctx.lineWidth = 8;
        ctx.textAlign = 'center';
        ctx.strokeText('¬°EXCELENTE!', canvas.width / 2, canvas.height / 2 - 20);
        ctx.fillText('¬°EXCELENTE!', canvas.width / 2, canvas.height / 2 - 20);
        
        ctx.font = 'bold 30px Arial';
        ctx.fillStyle = '#FFFFFF';
        ctx.strokeStyle = '#000000';
        ctx.lineWidth = 4;
        ctx.strokeText('¬°La jirafa est√° bien alimentada!', canvas.width / 2, canvas.height / 2 + 40);
        ctx.fillText('¬°La jirafa est√° bien alimentada!', canvas.width / 2, canvas.height / 2 + 40);
        
        // Reiniciar despu√©s de 3 segundos
        if (!resetGame.scheduled) {
            resetGame.scheduled = true;
            setTimeout(() => {
                resetGame();
                resetGame.scheduled = false;
            }, 3000);
        }
    }
    
    requestAnimationFrame(gameLoop);
}

gameLoop();
</script>
{% endblock %}
