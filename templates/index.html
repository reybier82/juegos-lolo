{% extends "base.html" %}

{% block title %}Juegos del Abecedario - Inicio{% endblock %}

{% block content %}
<!-- Bot贸n generador QR en esquina superior derecha -->
<button id="qrButton" class="qr-button" onclick="toggleQRGenerator()">
     Generar QR
</button>

<!-- Modal generador de QR -->
<div id="qrModal" class="qr-modal">
    <div class="qr-modal-content">
        <span class="qr-close" onclick="toggleQRGenerator()">&times;</span>
        <h2> Generador de C贸digos QR</h2>
        <div class="qr-form">
            <label for="urlInput">Ingresa la URL:</label>
            <input type="text" id="urlInput" placeholder="https://ejemplo.com" />
            <button onclick="generateQR()" class="qr-generate-btn">Generar QR</button>
        </div>
        <div id="qrCodeContainer" class="qr-code-container"></div>
        <div id="downloadSection" style="display: none;">
            <label for="fileNameInput">Nombre de la imagen:</label>
            <input type="text" id="fileNameInput" placeholder="codigo-qr" />
            <button onclick="downloadQR()" class="qr-download-btn">
                 Descargar QR
            </button>
        </div>
    </div>
</div>

<div class="main-header">
    <h1 class="title-rainbow"> Juegos del Abecedario </h1>
    <p class="subtitle">隆Toca una letra para jugar!</p>
</div>

<div class="alphabet-grid">
    {% for letra in letras %}
    <a href="{{ url_for('juego', letra=letra) }}" class="letter-card">
        <div class="letter-big">{{ letra }}</div>
        <div class="game-name">{{ juegos[letra]['nombre'] }}</div>
    </a>
    {% endfor %}
</div>

<div class="footer-info">
    <p> Juegos educativos para ni帽os de preescolar</p>
</div>
{% endblock %}

{% block extra_css %}
<style>
/* Bot贸n QR en esquina superior derecha */
.qr-button {
    position: fixed;
    top: 20px;
    right: 20px;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    border: none;
    padding: 12px 20px;
    border-radius: 25px;
    font-size: 16px;
    font-weight: bold;
    cursor: pointer;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
    transition: all 0.3s ease;
    z-index: 1000;
}

.qr-button:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
}

/* Modal QR */
.qr-modal {
    display: none;
    position: fixed;
    z-index: 2000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.7);
    animation: fadeIn 0.3s;
}

.qr-modal-content {
    background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
    margin: 5% auto;
    padding: 30px;
    border-radius: 20px;
    width: 90%;
    max-width: 500px;
    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
    animation: slideDown 0.3s;
}

.qr-modal-content h2 {
    color: #667eea;
    text-align: center;
    margin-bottom: 20px;
    font-size: 28px;
}

.qr-close {
    color: #aaa;
    float: right;
    font-size: 35px;
    font-weight: bold;
    cursor: pointer;
    transition: color 0.3s;
}

.qr-close:hover {
    color: #667eea;
}

.qr-form {
    margin-bottom: 20px;
}

.qr-form label {
    display: block;
    margin-bottom: 10px;
    color: #333;
    font-weight: bold;
    font-size: 16px;
}

.qr-form input {
    width: 100%;
    padding: 12px;
    border: 2px solid #667eea;
    border-radius: 10px;
    font-size: 16px;
    margin-bottom: 15px;
    box-sizing: border-box;
    transition: border-color 0.3s;
}

.qr-form input:focus {
    outline: none;
    border-color: #764ba2;
}

.qr-generate-btn {
    width: 100%;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    border: none;
    padding: 12px;
    border-radius: 10px;
    font-size: 18px;
    font-weight: bold;
    cursor: pointer;
    transition: all 0.3s;
}

.qr-generate-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
}

.qr-code-container {
    text-align: center;
    margin: 20px 0;
    min-height: 100px;
}

#downloadSection {
    margin-top: 20px;
}

#downloadSection label {
    display: block;
    margin-bottom: 10px;
    color: #333;
    font-weight: bold;
    font-size: 16px;
}

#downloadSection input {
    width: 100%;
    padding: 12px;
    border: 2px solid #4CAF50;
    border-radius: 10px;
    font-size: 16px;
    margin-bottom: 15px;
    box-sizing: border-box;
    transition: border-color 0.3s;
}

#downloadSection input:focus {
    outline: none;
    border-color: #45a049;
}

.qr-download-btn {
    width: 100%;
    background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
    color: white;
    border: none;
    padding: 12px;
    border-radius: 10px;
    font-size: 18px;
    font-weight: bold;
    cursor: pointer;
    transition: all 0.3s;
}

.qr-download-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(76, 175, 80, 0.4);
}

@keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

@keyframes slideDown {
    from {
        transform: translateY(-50px);
        opacity: 0;
    }
    to {
        transform: translateY(0);
        opacity: 1;
    }
}

/* Responsive */
@media (max-width: 768px) {
    .qr-button {
        top: 10px;
        right: 10px;
        padding: 10px 15px;
        font-size: 14px;
    }
    
    .qr-modal-content {
        width: 95%;
        margin: 10% auto;
        padding: 20px;
    }
}
</style>
{% endblock %}

{% block extra_js %}
<!-- Librer铆a QRCode.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>

<script>
let qrCodeInstance = null;

function toggleQRGenerator() {
    const modal = document.getElementById('qrModal');
    if (modal.style.display === 'block') {
        modal.style.display = 'none';
    } else {
        modal.style.display = 'block';
    }
}

function generateQR() {
    const urlInput = document.getElementById('urlInput');
    const url = urlInput.value.trim();
    
    if (!url) {
        alert('Por favor ingresa una URL');
        return;
    }
    
    // Validar URL b谩sica
    if (!url.startsWith('http://') && !url.startsWith('https://')) {
        alert('La URL debe comenzar con http:// o https://');
        return;
    }
    
    const container = document.getElementById('qrCodeContainer');
    const downloadSection = document.getElementById('downloadSection');
    
    // Limpiar QR anterior
    container.innerHTML = '';
    
    // Crear nuevo QR
    qrCodeInstance = new QRCode(container, {
        text: url,
        width: 256,
        height: 256,
        colorDark: '#000000',
        colorLight: '#ffffff',
        correctLevel: QRCode.CorrectLevel.H
    });
    
    // Mostrar secci贸n de descarga
    downloadSection.style.display = 'block';
    
    // Limpiar campo de nombre (opcional, mantener el 煤ltimo nombre)
    // document.getElementById('fileNameInput').value = '';
}

function downloadQR() {
    const container = document.getElementById('qrCodeContainer');
    const canvas = container.querySelector('canvas');
    
    if (!canvas) {
        alert('Primero genera un c贸digo QR');
        return;
    }
    
    // Obtener nombre personalizado
    const fileNameInput = document.getElementById('fileNameInput');
    let fileName = fileNameInput.value.trim();
    
    // Si no hay nombre, usar uno por defecto
    if (!fileName) {
        fileName = 'codigo-qr';
    }
    
    // Limpiar nombre de archivo (remover caracteres no permitidos)
    fileName = fileName.replace(/[^a-zA-Z0-9_-]/g, '_');
    
    // Convertir canvas a imagen y descargar
    const url = canvas.toDataURL('image/jpeg', 1.0);
    const link = document.createElement('a');
    link.download = fileName + '.jpg';
    link.href = url;
    link.click();
}

// Cerrar modal al hacer click fuera
window.onclick = function(event) {
    const modal = document.getElementById('qrModal');
    if (event.target === modal) {
        modal.style.display = 'none';
    }
}

// Permitir generar QR con Enter
document.addEventListener('DOMContentLoaded', function() {
    const urlInput = document.getElementById('urlInput');
    if (urlInput) {
        urlInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                generateQR();
            }
        });
    }
});
</script>
{% endblock %}
